<center><h1>微信小程序</h1></center>

## 1. MINA框架目录

### 1.1 目录结构

- `pages`：页面目录
  - index
    - `index.wxml`：标签文件，类似html
    - `index.wxss`：样式文件，类似css
    - `index.js`：脚本文件
    - `index.json`：配置文件
- `utils`：业务目录
- `app.js`：入口文件
- `app.json`：全局配置文件
- `app.wxss`：全局样式文件
- `project.config.json`：项目配置文件
- `sitemap.json`：微信索引配置文件

### 1.2 全局配置文件`app.json`

#### 1.2.1 entryPagePath（首页路径）

```json
{
  "entryPagePath": "pages/logs/logs",
  "pages": [
    "pages/index/index",
    "pages/logs/logs"
  ],
}

```

此时首页为 `pages/logs/logs`

#### 1.2.2 pages（页面路径列表）

- 数组形式
- 如果没有 `entryPagePath` 字段，开头第一个默认为首页

```json
{
  "pages": [
    "pages/index/index",
    "pages/logs/logs"
  ],
}
```

此时首页为 `pages/index/index`

#### 1.2.3 window（全局的默认窗口表现）

- `navigationBarBackgroundColor`：导航栏背景颜色，默认`#000000`
- `navigationBarTextStyle`：导航栏标题颜色，仅支持 `black` / `white`

- `navigationBarTitleText`：导航栏标题文字内容

- `navigationStyle`：导航栏样式，

  - 默认`default`

  - `custom` 去除默认导航栏，自定义导航栏，只保留右上角胶囊按钮。

- `enablePullDownRefresh`：开启全局的下拉刷新。，默认`false`

- `backgroundColor`：下拉刷新时窗口的背景色，只支持16进制

- `onReachBottomDistance`：下拉 loading 的样式，仅支持 `dark` / `light`

- `onReachBottomDistance`：页面上拉触底事件触发时距页面底部距离，单位为 `px`。
- `pageOrientation`：
  - auto：默认
  - portrait：
  - landscape：

- `backgroundColorTop`：顶部窗口的背景色，仅 iOS 支持
- `backgroundColorBottom`：底部窗口的背景色，仅 iOS 支持

#### 1.2.4 restartStrategy（[重新启动策略](https://developers.weixin.qq.com/miniprogram/dev/framework/runtime/operating-mechanism.html#_2-1-重新启动策略)配置）

- `homePage`：默认值，如果从这个页面退出小程序，下次将从首页冷启动
- `homePageAndLatestPage`：如果从这个页面退出小程序，下次冷启动后立刻加载这个页面，页面的参数保持不变（不可用于 tab 页）

#### 1.2.5 tabBar（导航栏）

- `color`：tab 上的文字默认颜色，仅支持十六进制颜色

- `selectedColor`：tab 上的文字选中时的颜色，仅支持十六进制颜色

- `backgroundColor`：tab 的背景色，仅支持十六进制颜色

- `borderStyle`：tabbar 上边框的颜色， 仅支持 `black` / `white`

- `list`：tab 的列表，详见 `list` 属性说明，最少 2 个、最多 5 个 tab

  - `pagePath`：页面路径，必须在 pages 中先定义
  - `text`：tab 上按钮文字
  - `iconPath`：图片路径，icon 大小限制为 40`kb`，建议尺寸为 81`px` * 81`px`，不支持网络图片。
  - `selectedIconPath`：选中时的图片路径，icon 大小限制为 40`kb`，建议尺寸为 81`px` * 81`px`，不支持网络图片。

- `position`：tabBar 的位置，仅支持 `bottom` / `top`

  - 注：为top时，图标默认不展示

- `custom`：自定义

  ```json
  {
    "tabBar": {
      "custom": true,
      "color": "#000000",
      "selectedColor": "#000000",
      "backgroundColor": "#000000",
      "list": [{
        "pagePath": "page/component/index",
        "text": "组件"
      }, {
        "pagePath": "page/API/index",
        "text": "接口"
      }]
    },
    "usingComponents": {}
  }
  ```



```json
{
    "tabBar": {
        "selectedColor": "1296db",
        "list": [
            {
                "pagePath": "pages/home/home",
                "text": "首页",
                "iconPath": "icon/home.png",
                "selectedIconPath": "icon/_home.png"
            },
            {
                "pagePath": "pages/img/img",
                "text": "图片",
                "iconPath": "icon/img.png",
                "selectedIconPath": "icon/_img.png"
            },
            {
                "pagePath": "pages/search/search",
                "text": "首页",
                "iconPath": "icon/search.png",
                "selectedIconPath": "icon/_search.png"
            },
            {
                "pagePath": "pages/my/my",
                "text": "图片",
                "iconPath": "icon/my.png",
                "selectedIconPath": "icon/_my.png"
            }
        ]
    },
}
```

#### 1.2.6 请求超时的时间（`networkTimeout`）

- `request`：[wx.request](https://developers.weixin.qq.com/miniprogram/dev/api/network/request/wx.request.html) 的超时时间，单位：毫秒。默认`60000`
- `connectSocket`：[wx.connectSocket](https://developers.weixin.qq.com/miniprogram/dev/api/network/websocket/wx.connectSocket.html) 的超时时间，单位：毫秒。
- `uploadFile`：[wx.uploadFile](https://developers.weixin.qq.com/miniprogram/dev/api/network/upload/wx.uploadFile.html) 的超时时间，单位：毫秒。
- `downloadFile`：[wx.downloadFile](https://developers.weixin.qq.com/miniprogram/dev/api/network/download/wx.downloadFile.html) 的超时时间，单位：毫秒。

## 2. 模板语法

- `text`：相当于 `span`
- `view`：相当于 `div`
- `checkboc`：复选框
- `block`：不会渲染成真实的DOM节点

### 2.1 数据绑定

- 简单绑定

  ```html
  <view>{{ msg }}</view>
  ```

  ```js
  Page({
    data: {
      msg: 'hello world'
    }
  })
  ```

- 复选框属性绑定

  ```html
  <checkbox value="" color="red" checked="{{ false }}" disabled="{{ false }}">
      
  </checkbox>
  ```

  - `color`：控制对勾的颜色
  - `checked`：是否被选中
  - `disabled`：是否禁用

### 2.2 简单运算

- 加减乘除：+，-，*，/，%
- 字符串拼接
- 三元表达式

### 2.3 列表渲染

可以遍历数据和对象

```html
<view
	wx:for="{{ arr }}"
    wx:for-item="item"
    wx:for-index="index"
    wx:key=""
>
	{{ index }} ---- {{ item }}
</view>
```

- `wx:for="{{ arr }}"`：要循环的数组或对象
- `wx:for-item="item"`：循环项，默认为 `item`
- `wx:for-index="index"`：循环索引，默认为 `index`
- `wx:key=""`：循环的key

#### 2.3.1 循环数组

```html
<view wx:for="{{ arr }}" wx:key="*this">
    {{ item }}
</view>
```

```js
Page({
    data: {
        arr: ['hello world',   'hello',   'world']
    },
})
```

循环数组普通数组时，可用`*this`

#### 2.3.2 循环对象

```html
<view wx:for="{{ obj }}" wx:for-item="value" wx:for-index="key" wx:key="key">
    {{ key }}: {{ value }}
</view>
```

```js
Page({
    data: {
        obj: {
            name: 'mie',
            age: 12,
            hobby: '篮球'
        }
    },
})
```

### 2.4 条件渲染

- `wx:if=""`
- `wx:elif=""`
- `wx:else`
- `hidden`

## 3. 事件绑定

先上个小demo

```html
<input value="{{ num }}" bindinput="handleInput" type="text"/>
<button bindtap="handleClick" data-add="-1">-</button>
<button bindtap="handleClick" data-add="+1">+</button>
{{ num }}
```

```js
Page({
  data: {
    num: 0
  },

  handleInput(e) {
    console.log(e.detail.value)
    this.setData({
      num: e.detail.value
    })
  },

  handleClick(e) {
    const key = e.target.dataset.add
    if(key === '-1') {
      this.setData({
        num: this.data.num + 1
      })
    } else {
      this.setData({
        num: this.data.num - 1
      })
    }
  }
})
```

- 事件命名：关键词 `bind` 加事件类型

  `bindinput`：input事件

  `bindtap`：click事件

- 函数传参：

  不能通过函数调用的形式来传参，需要通过自定义属性来传递参数，自定义属性以`data-`作为前缀，可以用过事件对象`e.target.dataset.xxx`来获取属性的值作为参数

- 修改值的方式：

  ```js
  this.setData({
      num: e.detail.value
  })
  ```

  通过对象的形式来修改data中的值



## 4. 样式（wxss）

### 4.1 单位（rpx）

`WXSS` (`WeiXin Style Sheets`)是一套样式语言，用于描述 `WXML` 的组件样式。

`rpx`（responsive pixel）: 可以根据屏幕宽度进行自适应。规定屏幕宽为`750rpx`。如在` iPhone6` 上，屏幕宽度为`375px`，共有750个物理像素，则`750rpx = 375px = 750`物理像素，`1rpx = 0.5px`物理像素。

### 4.2 引入

- 语法：`@import`
- 只支持相对路径

```css
@import '../../styles/global.wxss';
```

### 4.3 less应用

vsCode插件：easy less

```json
"less.compile": {
    "outExt": ".wxss"
}
```

img.less

```less
@import '../../styles/global.wxss';
@fontSize: 100rpx;
view {
    width: 100px;
    height: 100px;
    text {
        color: blue;
        font-size: @fontSize;
    }
}
```

img.wxss

```css
view {
  width: 200rpx;
  height: 200rpx;
  color: #fff;
  background: #000;
  border: 1px solid red;
  font-size: 80rpx;
  font-family: '微软雅黑';
}
view {
  width: 100px;
  height: 100px;
}
view text {
  color: blue;
  font-size: 100rpx;
}
```

## 5. 常见组件

### 5.1 视图容器

#### 5.1.1 view

视图容器，类似于div

属性：

- `hover-class`：指定按下去的样式类。当 `hover-class="none"` 时，没有点击态效果
- `hover-start-time`：按住后多久出现点击态，单位毫秒，默认50
- `hover-stay-time`：手指松开后点击态保留时间，单位毫秒，默认400

- `hover-stop-propagation`：阻止冒泡，默认为true

#### 5.1.2 swiper

滑块视图容器。其中只可放置[swiper-item](https://developers.weixin.qq.com/miniprogram/dev/component/swiper-item.html)组件，否则会导致未定义的行为。

默认宽度100%，高度150px

##### 属性：

- `indicator-dots`：是否显示面板指示点，默认false
- `indicator-color`：指示点颜色
- `indicator-active-color`：当前选中的指示点颜色
- `autoplay`：自动轮播
- `current`：当前所在滑块的 index
- `interval`：轮播间隔时长
- `duration`：轮播切换时长
- `circular`：是否采用衔接滑动
- `vertical`：滑动方向是否为纵向
- `previous-margin`：前边距，可用于露出前一项的一小部分，接受 px 和 rpx 值
- `next-margin`：后边距，可用于露出后一项的一小部分，接受 px 和 rpx 值
- `snap-to-edge`：当 swiper-item 的个数大于等于 2，关闭 circular 并且开启 previous-margin 或 next-margin 的时候，可以指定这个边距是否应用到第一个、最后一个元素
- `display-multiple-items`：同时显示的滑块数量
- `easing-function`：指定 swiper 切换缓动动画类型
  - `default`：默认缓动函数
  - `linear`：线性动画
  - `easeInCubic`：缓入动画
  - `easeOutCubic`：缓出动画
  - `easeInOutCubic`：缓入缓出动画

##### 事件

- `bindchange`：current 改变时会触发 change 事件
- `bindtransition`：swiper-item 的位置发生改变时会触发 transition 事件
- `bindanimationfinish`：动画结束时会触发 animationfinish 事件

#### 5.1.3 share-element



#### 5.1.4 scroll-view



#### 5.1.5 page-container



#### 5.1.6 movable-view



#### 5.1.7 movable-area



#### 5.1.8 match-media



#### 5.1.9 cover-view



#### 5.1.10 cover-image



### 5.2 基础内容

#### 5.2.1 text

- 文本标签，类似于span
- 里面只能嵌套text
- 长按文字可以复制
- 标签中可以识别空格，换行

属性：

- `selectable`：文本是否可选，默认false
- `space`：显示连续空格
- `decode`：是否解析编码，默认false

#### 5.2.2 rich-text

富文本标签

##### 属性

- `nodes`：节点列表/HTML String

  - 支持字符串

  - 支持数组，类似虚拟dom

    **元素节点：type = node**

    | 属性     | 说明       | 类型   | 必填 | 备注                                     |
    | -------- | ---------- | ------ | ---- | ---------------------------------------- |
    | name     | 标签名     | string | 是   | 支持部分受信任的 HTML 节点               |
    | attrs    | 属性       | object | 否   | 支持部分受信任的属性，遵循 Pascal 命名法 |
    | children | 子节点列表 | array  | 否   | 结构和 nodes 一致                        |

    **文本节点：type = text**

    | 属性 | 说明 | 类型   | 必填 | 备注         |
    | ---- | ---- | ------ | ---- | ------------ |
    | text | 文本 | string | 是   | 支持entities |

- `space`：显示连续空格

#### 5.2.3 icon

图标

##### 属性

- `type`：icon的类型
- `size`：icon大小，默认23px
- `color`：颜色

### 5.3 表单组件

#### 5.3.1 button

按钮。

##### 属性

- `size`：默认`default`，还有mini
- `typ`e：默认`default`，还有`primary`，`warn`
- `plain`：按钮是否镂空，背景色透明，默认false
- `disabled`：是否禁用，默认false
- `loading`：是否loading，默认false
- `form-type`：用于 [form](https://developers.weixin.qq.com/miniprogram/dev/component/form.html) 组件，点击分别会触发 [form](https://developers.weixin.qq.com/miniprogram/dev/component/form.html) 组件的 submit/reset 事件
  - `submit`：提交表单
  - `reset`：重置表单
- `open-type`：微信开放能力
  - `contact`：打开客服会话，如果用户在会话中点击消息卡片后返回小程序，可以从 bindcontact 回调中获得具体信息，[具体说明](https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/customer-message/customer-message.html) （*小程序插件中不能使用*）
- `hover-class`：指定按钮按下去的样式类
- `hover-stop-propagation`：阻止冒泡
- `lang`：指定返回用户信息的语言
  - `en`：英文
  - `zh_CN`：简体中文
  - `zh_TW`：繁体中文
- `open-type`：微信开放能力
  - `contact`：打开客服会话
    - `bindcontact`：客服消息回调
  - `share`：触发用户转发
  - `getPhoneNumber`：获取用户手机号
    - `bindgetphonenumber`：获取用户手机号回调
  - `getUserInfo`：获取用户信息
    - `bindgetuserinfo`：用户点击该按钮时，会返回获取到的用户信息
  - `launchApp`：打开app
  - `openSetting`：打开授权设置页
    - `bindopensetting`：在打开授权设置页后回调
  - `feedback`：用户建议反馈
  - `chooseAvatar`：获取用户头像
    - `bindchooseavatar`：获取用户头像回调

#### 5.3.2 radio

- 单选框
- 需要嵌套在`radio-group`中使用

##### `radio-group`事件

- `bindchange`：[radio-group](https://developers.weixin.qq.com/miniprogram/dev/component/radio-group.html)中选中项发生改变时触发 change 事件，detail = {value:[选中的radio的value的数组]}

##### `radio`属性

- `value`：[radio](https://developers.weixin.qq.com/miniprogram/dev/component/radio.html) 标识。当该[radio](https://developers.weixin.qq.com/miniprogram/dev/component/radio.html) 选中时，[radio-group](https://developers.weixin.qq.com/miniprogram/dev/component/radio-group.html) 的 change 事件会携带[radio](https://developers.weixin.qq.com/miniprogram/dev/component/radio.html)的value
- `checked`：当前是否选中
- `disabled`：是否禁用
- `color`：颜色

#### 5.3.3 checkbox

- 复选框
- 配合`checkbox-group`来使用

##### `checkbox-group`事件

- `bindchange`：[checkbox-group](https://developers.weixin.qq.com/miniprogram/dev/component/checkbox-group.html)中选中项发生改变时触发 change 事件，detail = {value:[选中的checkbox的value的数组]}

##### `checkbox`属性

- `value`：选中的值
- `disabled`：是否禁用
- `checked`：当前是否选中
- `color`：颜色

### 5.4 导航组件

#### 5.4.1 navigator

- 页面链接
- 块状元素，默认换行

##### 属性

- `target`：在哪个目标上发生跳转，默认当前小程序
  - `self`：当前小程序
  - `miniProgram`：其它小程序
- `url`：链接地址
- `open-type`：跳转方式
  - `navigate`：留当前页面，跳转到应用内的某个页面。但是不能跳到 tabbar 页面，对应 [wx.navigateTo](https://developers.weixin.qq.com/miniprogram/dev/api/route/wx.navigateTo.html) 或 [wx.navigateToMiniProgram](https://developers.weixin.qq.com/miniprogram/dev/api/navigate/wx.navigateToMiniProgram.html) 的功能
  - `navigate`：关闭当前页面，跳转到应用内的某个页面。但是不允许跳转到 tabbar 页面，对应 [wx.redirectTo](https://developers.weixin.qq.com/miniprogram/dev/api/route/wx.redirectTo.html) 的功能
  - `navigate`：跳转到 tabBar 页面，并关闭其他所有非 tabBar 页面，对应 [wx.switchTab](https://developers.weixin.qq.com/miniprogram/dev/api/route/wx.switchTab.html) 的功能
  - `navigate`：关闭所有页面，打开到应用内的某个页面，对应 [wx.reLaunch](https://developers.weixin.qq.com/miniprogram/dev/api/route/wx.reLaunch.html) 的功能
  - `navigate`：关闭当前页面，返回上一页面或多级页面，对应 [wx.navigateBack](https://developers.weixin.qq.com/miniprogram/dev/api/route/wx.navigateBack.html) 的功能
  - `navigate`：退出其他小程序，`target="miniProgram"`时生效

### 5.5 媒体组件

#### 5.5.1 image

- 支持 JPG、PNG、SVG、WEBP、GIF 等格式
- image组件存在默认宽高：宽320px，高240px

##### 属性

- `src`：图片资源地址
- `mode`：图片裁剪、缩放的模式，决定图片内容，宽高的适配
  - `scaleToFill`：默认值，不保持宽高比
  - `aspectFit`：保持纵横比缩放图片，以长边为准，短边部分图片居中，可完整展示图片
  - `aspectFill`：保持纵横比缩放图片，以短边为准，长边部分图片居中，不可完整展示图片
  - `widthFix`：设置宽，高度随比例变化
  - `heightFix`：设置高，宽度随比例变化
  - `top`：不缩放图片，图片位置居上
  - `bottom`：不缩放图片，图片位置居下
  - `center`：不缩放图片，图片位置居中
  - `left`：不缩放图片，图片位置居左
  - `top left`：不缩放图片，图片位置居左上
  - `top right`：不缩放图片，图片位置居右上
  - `bottom left`：不缩放图片，图片位置居左下
  - `bottom right`：不缩放图片，图片位置居右下
- `webp`：默认不解析 webP 格式，只支持网络资源
- `lazy-load`：图片懒加载，在即将进入一定范围（上下三屏）时才开始加载
- `show-menu-by-longpress`：默认false，长按图片显示发送给朋友、收藏、保存图片、搜一搜、打开名片/前往群聊/打开小程序（若图片中包含对应二维码或小程序码）的菜单。支持识别的码：小程序码 仅小程序支持识别的码：微信个人码、微信群码、企业微信个人码、 企业微信群码与企业微信互通群码；

##### 事件

- `binderror`：当错误发生时触发
- `bindload`：当图片载入完毕时触发

```html
<image class="" src="/images/abc.jpg" show-menu-by-longpress binderror="imgErr" bindload="imgSuccess"
```

```js
Page({
  imgErr() {
    console.log('加载失败')
  },
  imgSuccess() {
    console.log('加载成功')
  }
})
```

### 5.6 地图



### 5.7 画布



## 6. 自定义组件

类似于页面，一个自定义组件由 `json` `wxml` `wxss` `js` 4个文件组成。要编写一个自定义组件，首先需要在 `json` 文件中进行自定义组件声明（将 `component` 字段设为 `true` 可将这一组文件设为自定义组件）：

